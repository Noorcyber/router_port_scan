import nmap # Research done by Noor Shaheed 07/16/2023

def scan_network_devices(target_ip):
    nm = nmap.PortScanner()
    nm.scan(target_ip, arguments='-O -p 1-1000')  # Scan ports 1-1000 (modify as needed)
    device_info = []

    for host in nm.all_hosts():
        if 'osclass' in nm[host]:
            osclass = nm[host]['osclass'][0]
            vendor = osclass.get('vendor', 'Unknown')
            os_family = osclass.get('osfamily', 'Unknown')
            os_gen = osclass.get('osgen', 'Unknown')
            device_info.append({
                'IP': host,
                'Vendor': vendor,
                'Operating System': os_family,
                'OS Generation': os_gen
            })

        if nm[host].has_tcp(22):  # Check if port 22 (SSH) is open
            state = nm[host]['tcp'][22]['state']
            device_info[-1]['SSH Port'] = state

        if nm[host].has_tcp(80):  # Check if port 80 (HTTP) is open
            state = nm[host]['tcp'][80]['state']
            device_info[-1]['HTTP Port'] = state

        # Add more port checks as needed

    return device_info

# Example usage
target_ip = input('Enter an IP address:') # Replace with your router/firewall IP address
results = scan_network_devices(target_ip)

if results:
    print(f"Device Information for {target_ip}:")
    for device in results:
        print(f"IP: {device['IP']}")
        print(f"Vendor: {device['Vendor']}")
        print(f"Operating System: {device['Operating System']}")
        print(f"OS Generation: {device['OS Generation']}")
        if 'SSH Port' in device:
            print(f"SSH Port: {device['SSH Port']}")
        if 'HTTP Port' in device:
            print(f"HTTP Port: {device['HTTP Port']}")
        # Add more port details as needed
        print('---')
else:
    print("No devices found.")